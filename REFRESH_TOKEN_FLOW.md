# ğŸ”„ Refresh Token Flow Diagram

## Visual Flow: How Automatic Token Refresh Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER MAKES REQUEST                                  â”‚
â”‚                     (e.g., GET /api/protected-data)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Check Access Token in Cookies    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                    â”‚
         Token Exists?        Token Missing?
                â”‚                    â”‚
                â”‚                    â–¼
                â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚         â”‚ Check Refresh Token  â”‚
                â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                    â”‚
                â”‚              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                â”‚              â”‚            â”‚
                â”‚          Exists?      Missing?
                â”‚              â”‚            â”‚
                â”‚              â”‚            â–¼
                â”‚              â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚              â”‚    â”‚ REDIRECT TO  â”‚
                â”‚              â”‚    â”‚    LOGIN     â”‚
                â”‚              â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚              â”‚
                â”‚              â–¼
                â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚    â”‚ Try Refresh Token    â”‚
                â”‚    â”‚  (Skip to Step 5)    â”‚
                â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Send Request with Access Token                                     â”‚
â”‚  Header: Authorization: Bearer <access_token>                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      Backend Validates Token       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                    â”‚
         Token Valid?         Token Invalid/Expired?
                â”‚                    â”‚
                â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: SUCCESS!     â”‚  â”‚ STEP 3: Backend Returns Error  â”‚
â”‚  Return data to user  â”‚  â”‚ "invalid or expired token"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ STEP 4: Frontend Detects Error   â”‚
                          â”‚ isAuthError() returns true        â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Check if Refresh Token Available â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚                           â”‚
                    Available?                   Not Available?
                          â”‚                           â”‚
                          â”‚                           â–¼
                          â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚                  â”‚  Clear Cookies  â”‚
                          â”‚                  â”‚  REDIRECT TO    â”‚
                          â”‚                  â”‚     LOGIN       â”‚
                          â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: Call RefreshToken Mutation                                         â”‚
â”‚                                                                              â”‚
â”‚  mutation RefreshToken($refreshToken: String!) {                            â”‚
â”‚    refreshToken(refreshToken: $refreshToken) {                              â”‚
â”‚      accessToken                                                             â”‚
â”‚      refreshToken                                                            â”‚
â”‚      expiresIn                                                               â”‚
â”‚      tokenType                                                               â”‚
â”‚    }                                                                         â”‚
â”‚  }                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     Backend Validates Refresh      â”‚
         â”‚           Token                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                    â”‚
         Valid Refresh?       Invalid Refresh?
                â”‚                    â”‚
                â”‚                    â–¼
                â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚          â”‚  Clear Cookies   â”‚
                â”‚          â”‚  REDIRECT TO     â”‚
                â”‚          â”‚     LOGIN        â”‚
                â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: Backend Returns New Tokens                                         â”‚
â”‚  {                                                                           â”‚
â”‚    accessToken: "new_jwt_token...",                                         â”‚
â”‚    refreshToken: "new_refresh_token...",                                    â”‚
â”‚    expiresIn: 900,                                                           â”‚
â”‚    tokenType: "Bearer"                                                       â”‚
â”‚  }                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 7: Frontend Updates Cookies                                           â”‚
â”‚                                                                              â”‚
â”‚  cookie.set("accessToken", newToken, {                                      â”‚
â”‚    httpOnly: true,                                                           â”‚
â”‚    secure: true,                                                             â”‚
â”‚    sameSite: "strict",                                                       â”‚
â”‚    maxAge: 900                                                               â”‚
â”‚  });                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 8: Retry Original Request                                             â”‚
â”‚  Use new accessToken in Authorization header                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Backend Validates New Token      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 9: SUCCESS!                                                            â”‚
â”‚  Return data to user                                                         â”‚
â”‚  User never noticed their token expired! âœ¨                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Race Condition Prevention Flow

```
TIME    â”‚  REQUEST 1    â”‚  REQUEST 2    â”‚  REQUEST 3    â”‚  REFRESH STATE
â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  t0    â”‚  Expired âŒ   â”‚               â”‚               â”‚  isRefreshing: false
        â”‚               â”‚               â”‚               â”‚
  t1    â”‚  Detect Error â”‚               â”‚               â”‚  isRefreshing: false
        â”‚               â”‚               â”‚               â”‚
  t2    â”‚  Start Refreshâ”‚               â”‚               â”‚  isRefreshing: true
        â”‚  Create Promise              â”‚               â”‚  promise: PENDING
        â”‚               â”‚               â”‚               â”‚
  t3    â”‚  Refreshing...â”‚  Expired âŒ   â”‚               â”‚  isRefreshing: true
        â”‚               â”‚               â”‚               â”‚  promise: PENDING
        â”‚               â”‚               â”‚               â”‚
  t4    â”‚  Refreshing...â”‚  Detect Error â”‚               â”‚  isRefreshing: true
        â”‚               â”‚  Wait Promise â”‚               â”‚  promise: PENDING
        â”‚               â”‚               â”‚               â”‚
  t5    â”‚  Refreshing...â”‚  Waiting...   â”‚  Expired âŒ   â”‚  isRefreshing: true
        â”‚               â”‚               â”‚               â”‚  promise: PENDING
        â”‚               â”‚               â”‚               â”‚
  t6    â”‚  Refreshing...â”‚  Waiting...   â”‚  Detect Error â”‚  isRefreshing: true
        â”‚               â”‚               â”‚  Wait Promise â”‚  promise: PENDING
        â”‚               â”‚               â”‚               â”‚
  t7    â”‚  âœ… Success!  â”‚  Waiting...   â”‚  Waiting...   â”‚  isRefreshing: true
        â”‚  New Tokens   â”‚               â”‚               â”‚  promise: RESOLVED
        â”‚               â”‚               â”‚               â”‚
  t8    â”‚  Retry Successâ”‚  âœ… Use Tokensâ”‚  Waiting...   â”‚  isRefreshing: false
        â”‚               â”‚               â”‚               â”‚  promise: null
        â”‚               â”‚               â”‚               â”‚
  t9    â”‚  Return Data âœ¨â”‚  Retry Successâ”‚  âœ… Use Tokensâ”‚  isRefreshing: false
        â”‚               â”‚               â”‚               â”‚  promise: null
        â”‚               â”‚               â”‚               â”‚
  t10   â”‚               â”‚  Return Data âœ¨â”‚  Retry Successâ”‚  isRefreshing: false
        â”‚               â”‚               â”‚               â”‚  promise: null
        â”‚               â”‚               â”‚               â”‚
  t11   â”‚               â”‚               â”‚  Return Data âœ¨â”‚  isRefreshing: false
        â”‚               â”‚               â”‚               â”‚  promise: null

RESULT: âœ… Only 1 refresh mutation was called
        âœ… All 3 requests succeeded
        âœ… No race condition occurred
```

---

## ğŸ¯ Code Execution Path

### When Token is Valid

```
User Action
    â”‚
    â–¼
checkAuth()
    â”‚
    â”œâ”€â–º Get accessToken from cookies
    â”‚
    â”œâ”€â–º Call getCurrentUser(accessToken)
    â”‚
    â”œâ”€â–º GraphQL Request to Backend
    â”‚
    â”œâ”€â–º Backend validates token âœ…
    â”‚
    â”œâ”€â–º Return user data
    â”‚
    â””â”€â–º Return { authenticated: true, user: {...} }
```

### When Token is Expired

```
User Action
    â”‚
    â–¼
checkAuth()
    â”‚
    â”œâ”€â–º Get accessToken from cookies
    â”‚
    â”œâ”€â–º Call getCurrentUser(accessToken)
    â”‚
    â”œâ”€â–º GraphQL Request to Backend
    â”‚
    â”œâ”€â–º Backend validates token âŒ "expired token"
    â”‚
    â”œâ”€â–º Catch error
    â”‚
    â”œâ”€â–º isAuthError(error) â†’ true
    â”‚
    â”œâ”€â–º Get refreshToken from cookies
    â”‚
    â”œâ”€â–º Call refreshTokenServer(refreshToken)
    â”‚   â”‚
    â”‚   â”œâ”€â–º Check if already refreshing
    â”‚   â”‚   â””â”€â–º If yes: wait for existing promise
    â”‚   â”‚   â””â”€â–º If no: start new refresh
    â”‚   â”‚
    â”‚   â”œâ”€â–º GraphQL RefreshToken Mutation
    â”‚   â”‚
    â”‚   â”œâ”€â–º Backend validates refresh token âœ…
    â”‚   â”‚
    â”‚   â”œâ”€â–º Backend returns new tokens
    â”‚   â”‚
    â”‚   â””â”€â–º Update cookies with new tokens
    â”‚
    â”œâ”€â–º Retry getCurrentUser(newAccessToken)
    â”‚
    â”œâ”€â–º Backend validates new token âœ…
    â”‚
    â”œâ”€â–º Return user data
    â”‚
    â””â”€â–º Return { authenticated: true, user: {...} }
```

### When Refresh Token is Invalid

```
User Action
    â”‚
    â–¼
checkAuth()
    â”‚
    â”œâ”€â–º Get accessToken from cookies
    â”‚
    â”œâ”€â–º Call getCurrentUser(accessToken)
    â”‚
    â”œâ”€â–º Backend returns error âŒ
    â”‚
    â”œâ”€â–º isAuthError(error) â†’ true
    â”‚
    â”œâ”€â–º Get refreshToken from cookies
    â”‚
    â”œâ”€â–º Call refreshTokenServer(refreshToken)
    â”‚   â”‚
    â”‚   â”œâ”€â–º GraphQL RefreshToken Mutation
    â”‚   â”‚
    â”‚   â”œâ”€â–º Backend validates refresh token âŒ "invalid refresh token"
    â”‚   â”‚
    â”‚   â”œâ”€â–º Catch error
    â”‚   â”‚
    â”‚   â””â”€â–º Clear all cookies
    â”‚
    â”œâ”€â–º Refresh failed
    â”‚
    â”œâ”€â–º Clear all cookies
    â”‚
    â””â”€â–º Return { authenticated: false, redirectTo: "/auth/login" }
```

---

## ğŸ—ï¸ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND APPLICATION                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    USER INTERFACE                           â”‚   â”‚
â”‚  â”‚  (Components, Pages, Forms)                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                          â”‚
â”‚                          â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              AUTHENTICATION MIDDLEWARE                      â”‚   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â”‚  â€¢ checkAuth()                                             â”‚   â”‚
â”‚  â”‚  â€¢ requireAuth()                                           â”‚   â”‚
â”‚  â”‚  â€¢ requireAdmin()                                          â”‚   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚     TOKEN REFRESH UTILITY                        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ refreshTokenServer()  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ refreshTokenClient()            â”‚            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ isAuthError()                   â”‚            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ getErrorMessage()               â”‚            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                    â”‚            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Race Condition Prevention:        â”‚            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ isRefreshing flag              â”‚            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ refreshPromise cache           â”‚            â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                    â”‚                â”‚                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â”‚                â”‚                        â”‚
â”‚                       â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                       â–¼                         â”‚               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚               â”‚
â”‚  â”‚    GRAPHQL CLIENT                  â”‚        â”‚               â”‚
â”‚  â”‚                                    â”‚        â”‚               â”‚
â”‚  â”‚  â€¢ createGraphQLClient()          â”‚        â”‚               â”‚
â”‚  â”‚  â€¢ createAuthenticatedClient()    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚  â”‚                                    â”‚                        â”‚
â”‚  â”‚  Features:                         â”‚                        â”‚
â”‚  â”‚  â€¢ Auto-retry on auth errors      â”‚                        â”‚
â”‚  â”‚  â€¢ Token refresh integration      â”‚                        â”‚
â”‚  â”‚  â€¢ Request/response logging       â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                   â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  COOKIE STORAGEâ”‚                                        â”‚  â”‚
â”‚  â”‚                â–¼                                        â”‚  â”‚
â”‚  â”‚  â€¢ accessToken  (httpOnly, secure, 15min)             â”‚  â”‚
â”‚  â”‚  â€¢ refreshToken (httpOnly, secure, 7days)             â”‚  â”‚
â”‚  â”‚  â€¢ user         (readable, secure)                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTTPS
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BACKEND API                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    GRAPHQL ENDPOINT                         â”‚   â”‚
â”‚  â”‚                 (http://localhost:4001/graphql)            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                          â”‚
â”‚                          â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  AUTHENTICATION RESOLVERS                   â”‚   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â”‚  Queries:                                                  â”‚   â”‚
â”‚  â”‚  â€¢ me() - Get current user                                â”‚   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â”‚  Mutations:                                                â”‚   â”‚
â”‚  â”‚  â€¢ login(input: LoginInput) â†’ LoginResponse              â”‚   â”‚
â”‚  â”‚  â€¢ register(input: RegisterInput) â†’ LoginResponse        â”‚   â”‚
â”‚  â”‚  â€¢ refreshToken(refreshToken: String!) â†’ TokenPair       â”‚   â”‚
â”‚  â”‚  â€¢ changePassword(input: ChangePasswordInput) â†’ Boolean  â”‚   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                          â”‚
â”‚                          â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              TOKEN VALIDATION & GENERATION                  â”‚   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â”‚  â€¢ Validate JWT access tokens                              â”‚   â”‚
â”‚  â”‚  â€¢ Validate refresh tokens                                 â”‚   â”‚
â”‚  â”‚  â€¢ Generate new token pairs                                â”‚   â”‚
â”‚  â”‚  â€¢ Check token expiry                                      â”‚   â”‚
â”‚  â”‚  â€¢ Verify token signatures                                 â”‚   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                          â”‚
â”‚                          â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      DATABASE                               â”‚   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â”‚  â€¢ Users table                                             â”‚   â”‚
â”‚  â”‚  â€¢ Refresh tokens table (optional)                         â”‚   â”‚
â”‚  â”‚  â€¢ Token blacklist (optional)                              â”‚   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Sequence Diagram

```
User        Frontend          GraphQL Client     Token Refresh      Backend
 â”‚              â”‚                    â”‚                 â”‚               â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                 â”‚               â”‚
 â”‚  Click Link  â”‚                    â”‚                 â”‚               â”‚
 â”‚              â”‚                    â”‚                 â”‚               â”‚
 â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚               â”‚
 â”‚              â”‚  Request Data      â”‚                 â”‚               â”‚
 â”‚              â”‚  (with token)      â”‚                 â”‚               â”‚
 â”‚              â”‚                    â”‚                 â”‚               â”‚
 â”‚              â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚              â”‚                    â”‚  GET /api/data                  â”‚
 â”‚              â”‚                    â”‚  Authorization: Bearer <token>  â”‚
 â”‚              â”‚                    â”‚                 â”‚               â”‚
 â”‚              â”‚                    â”‚                 â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚              â”‚                    â”‚                 â”‚    â”‚ Validate â”‚
 â”‚              â”‚                    â”‚                 â”‚    â”‚  Token   â”‚
 â”‚              â”‚                    â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚              â”‚                    â”‚                 â”‚               â”‚
 â”‚              â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚              â”‚                    â”‚  âŒ "expired token"             â”‚
 â”‚              â”‚                    â”‚                 â”‚               â”‚
 â”‚              â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
 â”‚              â”‚                    â”‚  Detect Auth Error              â”‚
 â”‚              â”‚                    â”‚                 â”‚               â”‚
 â”‚              â”‚                    â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚              â”‚                    â”‚                 â”‚  refreshToken â”‚
 â”‚              â”‚                    â”‚                 â”‚  mutation     â”‚
 â”‚              â”‚                    â”‚                 â”‚               â”‚
 â”‚              â”‚                    â”‚                 â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚              â”‚                    â”‚                 â”‚    â”‚ Validate â”‚
 â”‚              â”‚                    â”‚                 â”‚    â”‚ Refresh  â”‚
 â”‚              â”‚                    â”‚                 â”‚    â”‚  Token   â”‚
 â”‚              â”‚                    â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚              â”‚                    â”‚                 â”‚               â”‚
 â”‚              â”‚                    â”‚                 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚              â”‚                    â”‚                 â”‚  âœ… New Tokensâ”‚
 â”‚              â”‚                    â”‚                 â”‚               â”‚
 â”‚              â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
 â”‚              â”‚                    â”‚  Update cookies â”‚               â”‚
 â”‚              â”‚                    â”‚                 â”‚               â”‚
 â”‚              â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚              â”‚                    â”‚  RETRY: GET /api/data           â”‚
 â”‚              â”‚                    â”‚  Authorization: Bearer <new>    â”‚
 â”‚              â”‚                    â”‚                 â”‚               â”‚
 â”‚              â”‚                    â”‚                 â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚              â”‚                    â”‚                 â”‚    â”‚ Validate â”‚
 â”‚              â”‚                    â”‚                 â”‚    â”‚New Token â”‚
 â”‚              â”‚                    â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚              â”‚                    â”‚                 â”‚               â”‚
 â”‚              â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚              â”‚                    â”‚  âœ… Data                        â”‚
 â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚               â”‚
 â”‚              â”‚  Return data       â”‚                 â”‚               â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                 â”‚               â”‚
 â”‚  Show data   â”‚                    â”‚                 â”‚               â”‚
 â”‚  (no error!) â”‚                    â”‚                 â”‚               â”‚
```

---

## ğŸ¯ Key Points

1. **Transparent to User**: Token refresh happens automatically in the background
2. **Race Condition Safe**: Multiple concurrent requests share one refresh
3. **Secure**: Tokens stored in HTTP-only cookies
4. **Resilient**: Handles various error scenarios gracefully
5. **Performant**: Minimal overhead, only refreshes when needed

---

**Last Updated**: 2025-01-27
**Version**: 1.0.0
